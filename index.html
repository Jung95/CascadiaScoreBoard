<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cascadia Scoreboard</title>
    <script src="https://code.jquery.com/jquery-3.6.1.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
    <!-- CSS only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <!-- JavaScript Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
</head>
<body>
    <div id="playerNumberSelector">
        <span>
            <h2>Player Number</h2>
        </span>
        <br>
        <button type="button" class="btn btn-primary" onClick="setPlayerNumber(1)">1</button>
        <button type="button" class="btn btn-success" onClick="setPlayerNumber(2)">2</button>
        <button type="button" class="btn btn-warning" onClick="setPlayerNumber(3)">3</button>
        <button type="button" class="btn btn-info" onClick="setPlayerNumber(4)">4</button>
    </div>
    <div id="playerNameSelcetor">
        <form>
            <div class="form-group">
                <label for="playerName">Player<span id="selectedPlayer"></span> Name</label>
                <input type="text" class="form-control" id="playerName" placeholder="Player Name">
            </div>
            <button type="button" class="btn btn-primary" onClick="preName()">Pre</button>
            <button type="button" class="btn btn-primary" onClick="nextName()">Next</button>
        </form>
    </div>
    <div id="scoreboard">
        <table class="table">
            <thead class="thead-dark">
                <tr>
                <th scope="col">#</th>
                <th scope="col"><span id="scoreName"></span></th>
                </tr>
            </thead>
            <tbody>
                <tr>
                <th scope="row">곰</th>
                <td><input type="number" id="bear"></td>
                </tr>
                <tr>
                <th scope="row">연어</th>
                <td><input type="number" id="salmon"></td>
                </tr>
                <tr>
                <th scope="row">사슴</th>
                <td><input type="number" id="dear"></td>
                </tr>
                <tr>
                <th scope="row">매</th>
                <td><input type="number" id="falcon"></td>
                </tr>
                <tr>
                <th scope="row">여우</th>
                <td><input type="number" id="fox"></td>
                </tr>
                <tr>
                <th scope="row">툰드라</th>
                <td><input type="number" id="snow"></td>
                </tr>
                <tr>
                <th scope="row">숲</th>
                <td><input type="number" id="forest"></td>
                </tr>
                <tr>
                <th scope="row">사막</th>
                <td><input type="number" id="desert"></td>
                </tr>
                <tr>
                <th scope="row">습지</th>
                <td><input type="number" id="marsh"></td>
                </tr>
                <tr>
                <th scope="row">바다</th>
                <td><input type="number" id="sea"></td>
                </tr>
                <tr>
                <th scope="row">솔방울</th>
                <td><input type="number" id="pine"></td>
                </tr>
            </tbody>
            </table>
            <button type="button" class="btn btn-primary" onClick="preScore()">Pre</button>
            <button type="button" class="btn btn-primary" onClick="nextScore()">Next</button>
    </div>
    <div id="resultboard">
        <h2>Result</h2>
        <table class="table">
            <thead class="thead-dark">
                <tr id="resultName">
                <th scope="col">#</th>
                </tr>
            </thead>
            <tbody>
                <tr id="resultBear">
                <th scope="row">곰</th>
                </tr>
                <tr id="resultSalmon">
                <th scope="row">연어</th>
                </tr>
                <tr id="resultDear">
                <th scope="row">사슴</th>
                </tr>
                <tr id="resultFalcon">
                <th scope="row">매</th>
                </tr>
                <tr id="resultFox">
                <th scope="row">여우</th>
                </tr>
                <tr id="resultAnimal">
                <th scope="row">동물점수</th>
                </tr>
                <tr id="resultSnow">
                <th scope="row">툰드라</th>
                </tr>
                <tr id="resultForest">
                <th scope="row">숲</th>
                </tr>
                <tr id="resultDesert">
                <th scope="row">사막</th>
                </tr>
                <tr id="resultMarsh">
                <th scope="row">습지</th>
                </tr>
                <tr id="resultSea">
                <th scope="row">바다</th>
                </tr>
                <tr id="resultWild">
                <th scope="row">지형점수</th>
                </tr>
                <tr id="resultPine">
                <th scope="row">솔방울</th>
                </tr>
                <tr id="resultTotal">
                <th scope="row">총점</th>
                </tr>
            </tbody>
            </table>
    </div>
    <script>
        $( document ).ready(function() {
            $('#playerNameSelcetor').hide()
             $('#scoreboard').hide()
            $('#resultboard').hide()
        });
        class Player{
            constructor(number){
                this.name = 'player ' + number
                this.default = true
                //animal
                this.bear = 0;
                this.salmon = 0;
                this.dear = 0;
                this.falcon = 0;
                this.fox = 0;
                //wild
                this.snow = 0;
                this.forest = 0;
                this.desert = 0;
                this.marsh = 0;
                this.sea = 0;
                //pine
                this.pine = 0;
                // bonus
                this.snowB = 0;
                this.forestB = 0;
                this.desertB = 0;
                this.marshB = 0;
                this.seaB = 0;
                // total
                this.animal = 0;
                this.wild = 0;
                this.total = 0;
            }

            setName(name){
                if(name !== ''){
                    this.name = name
                    this.default = false
                }

            }
        }
        let state = 0;
        let playerNumber = 0;
        let selectedPlayer = 0;
        const players = new Array()
        function setPlayerNumber(number){
            playerNumber = number
            state = 1;
            for (let index = 0; index < number; index++) {
                players[index] = new Player(index+1)
            }
            $('#playerNumberSelector').hide()
            $('#playerNameSelcetor').show()
            $('#selectedPlayer').text(selectedPlayer+1)

        }
        function preName(){
            if(selectedPlayer == 0){
                $('#playerNameSelcetor').hide()
                $('#playerNumberSelector').show()
                state = 0;
            }else{
                selectedPlayer = selectedPlayer - 1
                $('#selectedPlayer').text(selectedPlayer + 1)
                if(!players[selectedPlayer].default){
                    $('#playerName').val(players[selectedPlayer].name)
                }

            }
        }
        function nextName(){
            players[selectedPlayer].setName($('#playerName').val())
            if(selectedPlayer == (playerNumber-1)){
                $('#playerNameSelcetor').hide()
                $('#scoreboard').show()
                state = 2;
                selectedPlayer = 0;
                $('#scoreName').text(players[selectedPlayer].name)
                 $('#bear').val(players[selectedPlayer].bear);
                $('#salmon').val(players[selectedPlayer].salmon);
                $('#dear').val(players[selectedPlayer].dear);
                $('#falcon').val(players[selectedPlayer].falcon);
                $('#fox').val(players[selectedPlayer].fox);
                $('#snow').val(players[selectedPlayer].snow);
                $('#forest').val(players[selectedPlayer].forest);
                $('#desert').val(players[selectedPlayer].desert);
                $('#marsh').val(players[selectedPlayer].marsh);
                $('#sea').val(players[selectedPlayer].sea);
                $('#pine').val(players[selectedPlayer].pine);
            }else{
                selectedPlayer = selectedPlayer + 1
                $('#selectedPlayer').text(selectedPlayer+1)
                if(!players[selectedPlayer].default){
                    $('#playerName').val(players[selectedPlayer].name)
                }else{
                    $('#playerName').val('')
                }
            }
        }

        function preScore(){
            if(selectedPlayer == 0){
                selectedPlayer = playerNumber - 1
                $('#scoreboard').hide()
                $('#playerNameSelcetor').show()
                state = 0;
            }else{
                selectedPlayer = selectedPlayer - 1;
                $('#scoreName').text(players[selectedPlayer].name)
                $('#bear').val(players[selectedPlayer].bear);
                $('#salmon').val(players[selectedPlayer].salmon);
                $('#dear').val(players[selectedPlayer].dear);
                $('#falcon').val(players[selectedPlayer].falcon);
                $('#fox').val(players[selectedPlayer].fox);
                $('#snow').val(players[selectedPlayer].snow);
                $('#forest').val(players[selectedPlayer].forest);
                $('#desert').val(players[selectedPlayer].desert);
                $('#marsh').val(players[selectedPlayer].marsh);
                $('#sea').val(players[selectedPlayer].sea);
                $('#pine').val(players[selectedPlayer].pine);
            }

        }

        function nextScore(){
                players[selectedPlayer].bear = parseInt($('#bear').val());
                players[selectedPlayer].salmon = parseInt($('#salmon').val());
                players[selectedPlayer].dear = parseInt($('#dear').val());
                players[selectedPlayer].falcon =parseInt( $('#falcon').val());
                players[selectedPlayer].fox = parseInt($('#fox').val());
                players[selectedPlayer].snow = parseInt($('#snow').val());
                players[selectedPlayer].forest =parseInt( $('#forest').val());
                players[selectedPlayer].desert =parseInt( $('#desert').val());
                players[selectedPlayer].marsh =parseInt( $('#marsh').val());
                players[selectedPlayer].sea = parseInt($('#sea').val());
                players[selectedPlayer].pine =parseInt( $('#pine').val());

                 if(selectedPlayer == (playerNumber-1)){
                    calcResult()
                    $('#scoreboard').hide()
                    $('#resultboard').show()
                    state = 3;
                    selectedPlayer = 0;
                }else{
                    selectedPlayer = selectedPlayer + 1;
                    $('#scoreName').text(players[selectedPlayer].name)
                    $('#bear').val(players[selectedPlayer].bear);
                    $('#salmon').val(players[selectedPlayer].salmon);
                    $('#dear').val(players[selectedPlayer].dear);
                    $('#falcon').val(players[selectedPlayer].falcon);
                    $('#fox').val(players[selectedPlayer].fox);
                    $('#snow').val(players[selectedPlayer].snow);
                    $('#forest').val(players[selectedPlayer].forest);
                    $('#desert').val(players[selectedPlayer].desert);
                    $('#marsh').val(players[selectedPlayer].marsh);
                    $('#sea').val(players[selectedPlayer].sea);
                    $('#pine').val(players[selectedPlayer].pine);
                }
        }

        function calcResult(){
            //  1st : 3 , 2nd : 1 // 2
            if(playerNumber == 1){
                if(players[0].snow >= 7){
                    players[0].snowB = 2
                }
                if(players[0].forest >= 7){
                    players[0].forestB = 2
                }
                if(players[0].desert >= 7){
                    players[0].desertB = 2
                }
                if(players[0].marsh >= 7){
                    players[0].marshB = 2
                }
                if(players[0].sea >= 7){
                    players[0].seaB = 2
                }
            }
            else if(playerNumber == 2){
                //snow
                if(players[0].snow > players[1].snow){
                    players[0].snowB = 2
                }else if(players[0].snow == players[1].snow){
                    players[0].snowB = 1
                    players[1].snowB = 1
                }else if(players[0].snow < players[1].snow){
                    players[1].snowB = 2
                }
                //forest
                if(players[0].forest > players[1].forest){
                    players[0].forestB = 2
                }else if(players[0].forest == players[1].forest){
                    players[0].forestB = 1
                    players[1].forestB = 1
                }else if(players[0].forest < players[1].forest){
                    players[1].forestB = 2
                }   
                //desert
                if(players[0].desert > players[1].desert){
                    players[0].desertB = 2
                }else if(players[0].desert == players[1].desert){
                    players[0].desertB = 1
                    players[1].desertB = 1
                }else if(players[0].desert < players[1].desert){
                    players[1].desertB = 2
                }  
                //marsh
                if(players[0].marsh > players[1].marsh){
                    players[0].marshB = 2
                }else if(players[0].marsh == players[1].marsh){
                    players[0].marshB = 1
                    players[1].marshB = 1
                }else if(players[0].marsh < players[1].marsh){
                    players[1].marshB = 2
                }  
                //sea
                if(players[0].sea > players[1].sea){
                    players[0].seaB = 2
                }else if(players[0].sea == players[1].sea){
                    players[0].seaB = 1
                    players[1].seaB = 1
                }else if(players[0].sea < players[1].sea){
                    players[1].seaB = 2
                }               

            }else if(playerNumber >= 3){
                // #1st = 1  #2nd = 1 (3,1)
                // #1st = 2   (2)
                // #1st = 3,4 (1)
                let snows = new Array()
                let forests = new Array()
                let deserts = new Array()
                let marshs = new Array()
                let seas = new Array()
                for (let index = 0; index < playerNumber; index++) {
                  snows.push(players[index].snow)
                  forests.push(players[index].forest)
                  deserts.push(players[index].desert)
                  marshs.push(players[index].marsh)
                  seas.push(players[index].sea)
                }
                //snow
                let bonusSnowIndex = bonus(snows)
                let bonusSnow = 3
                if(bonusSnowIndex['first'].length > 1){
                    bonusSnow = Math.floor(4/bonusSnowIndex['first'].length) 
                }
                bonusSnowIndex['first'].forEach(index => {
                    players[index].snowB = bonusSnow
                });
                if(bonusSnowIndex['first'].length == 1 && bonusSnowIndex['second'].length == 1){
                    players[bonusSnowIndex['second'][0]].snowB = 1
                }
                //forest
                let bonusForestIndex = bonus(forests)
                let bonusForest = 3
                if(bonusForestIndex['first'].length > 1){
                    bonusForest = Math.floor(4/bonusForestIndex['first'].length) 
                }
                bonusForestIndex['first'].forEach(index => {
                    players[index].forestB = bonusForest
                });
                if(bonusForestIndex['first'].length == 1 && bonusForestIndex['second'].length == 1){
                    players[bonusForestIndex['second'][0]].forestB = 1
                }
                //desert
                let bonusDesertIndex = bonus(deserts)
                let bonusDesert = 3
                if(bonusDesertIndex['first'].length > 1){
                    bonusDesert = Math.floor(4/bonusDesertIndex['first'].length) 
                }
                bonusDesertIndex['first'].forEach(index => {
                    players[index].desertB = bonusDesert
                });
                if(bonusDesertIndex['first'].length == 1 && bonusDesertIndex['second'].length == 1){
                    players[bonusDesertIndex['second'][0]].desertB = 1
                }
                //marsh
                let bonusMarshIndex = bonus(marshs)
                let bonusMarsh = 3
                if(bonusMarshIndex['first'].length > 1){
                    bonusMarsh = Math.floor(4/bonusMarshIndex['first'].length) 
                }
                bonusMarshIndex['first'].forEach(index => {
                    players[index].marshB = bonusMarsh
                });
                if(bonusMarshIndex['first'].length == 1 && bonusMarshIndex['second'].length == 1){
                    players[bonusMarshIndex['second'][0]].marshB = 1
                }
                //sea
                let bonusSeaIndex = bonus(seas)
                let bonusSea = 3
                if(bonusSeaIndex['first'].length > 1){
                    bonusSea = Math.floor(4/bonusSeaIndex['first'].length) 
                }
                bonusSeaIndex['first'].forEach(index => {
                    players[index].seaB = bonusSea
                });
                if(bonusSeaIndex['first'].length == 1 && bonusSeaIndex['second'].length == 1){
                    players[bonusSeaIndex['second'][0]].seaB = 1
                }

            }
            for (let index = 0; index < playerNumber; index++) {
                players[index].animal =  players[index].bear +  players[index].falcon +  players[index].dear +  players[index].salmon +  players[index].fox
                players[index].wild = players[index].snow + players[index].snowB + players[index].forest + players[index].forestB + players[index].desert + players[index].desertB + players[index].marsh + players[index].marshB + players[index].sea + players[index].seaB
                players[index].total = players[index].animal + players[index].wild + players[index].pine
                $('#resultName').append('<th>' + players[index].name + '</th>')  
                $('#resultBear').append('<th>' + players[index].bear  + '</th>')
                $('#resultDear').append('<th>' + players[index].dear  + '</th>')
                $('#resultFalcon').append('<th>' + players[index].falcon  + '</th>')
                $('#resultFox').append('<th>' + players[index].fox  + '</th>')
                $('#resultSalmon').append('<th>' + players[index].salmon  + '</th>')
                $('#resultAnimal').append('<th>' + players[index].animal  + '</th>')
                $('#resultSnow').append('<th>' + players[index].snow +' / +' + players[index].snowB + '</th>')
                $('#resultForest').append('<th>' + players[index].forest +' / +' + players[index].forestB + '</th>')
                $('#resultDesert').append('<th>' + players[index].desert +' / +' + players[index].desertB + '</th>')  
                $('#resultMarsh').append('<th>' + players[index].marsh +' / +' + players[index].marshB + '</th>')
                $('#resultSea').append('<th>' + players[index].sea +' / +' + players[index].seaB + '</th>')
                $('#resultWild').append('<th>' + players[index].wild  + '</th>')
                $('#resultPine').append('<th>' + players[index].pine  + '</th>')
                $('#resultTotal').append('<th>' + players[index].total  + '</th>')
            }

        }
        function bonus(array){
            let bestScore = 0
            let secondScore = 0
            let first = new Array()
            let second = new Array()
            for (let index = 0; index < array.length; index++) {
                const element = array[index];
                if(bestScore == element){
                    first.push(index)
                }else if(bestScore < element){
                    secondScore = bestScore
                    bestScore = element
                    second = first.slice()
                    first = new Array()
                    first.push(index)
                }else if(secondScore == element){
                    second.push(index)
                }else if(secondScore < element){
                    secondScore = element
                    second = new Array()
                    second.push(index)
                }
            }
            return {first : first, second: second}
        }
    </script>
</body>
</html>